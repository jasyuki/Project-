# Absenteeism at work
======================
## By we are not here

# Introduction
We are studying Absenteeism at work, because we believe the majority of us will work in the future, and it will be interesting for us to investigate  different aspects affecting absenteeism.
We got our data set from website 'Kaggle' which they obtained from 'UCI machine learning repository'. The link is following: 'https://archive.ics.uci.edu/ml/datasets/Absenteeism+at+work'. There are 21 variables and 740 observations.

```{r load-data, include=FALSE}
library(tidyverse)
library(tidymodels)
library(knitr)
library(xaringanthemer)
absenteeism <- read_csv("C:/Users/jasgu/Documents/.Uni Stuff Ig/IDS project/Project-weNotHere/Data/Absenteesim At Work.csv")
```
```{r glimpse, out.width = "20%", out.height = "20%", echo = FALSE}
head(absenteeism, 10)
```

# Cleaning our data
The first step we took in our project was cleaning the data. We deleted some of the variables: 'Hit target', 'Disciplinary failure', and 'Reason for absence'. We did this because: 'Hit target' is a vague variable name we couldn't make sense of; 'Disciplinary failure' wasn't relevant for our investigation and 'Reason for absence' because we believe it is not important to know why people are absent, only the factors influencing absenteeism.

```{r}
# Getting rid of unneeded/unwanted variables 
absenteeism <- select(absenteeism, -c(Reason_for_absence, Hit_target, Disciplinary_failure) ) 
```
We also find it may be useful to get rid of the people with 0 hours of absenteeism, becuase we are only interested in people who have been absent.
```{r}
absenteeism <- filter(absenteeism, Absenteeism_time_in_hours != 0)
absenteeism
```

After deleting our variables, we change the name of the column called 'Son' to children as this is more representative. Also we modified the variable 'Day of the Week' as originally Monday was two, Friday was six, so to make more sense, we changed Monday to one and Tuesday to two, etc. 

```{r}
absenteeism <- filter(absenteeism, Month_of_absence != 0)
absenteeism$Day_of_the_week <- absenteeism$Day_of_the_week -1  # Changing days of the week to 1 = Monday, 5 = Friday
colnames(absenteeism)[colnames(absenteeism) == "Son"] <- "Children"
```
In the end we split the data set into several groups. 

# Details of spliting data set.
We first created a group called 'Social', which basically includes all social factors which cause people to be absent, which are 'Education', 'Children', 'Social drinker', 'Social smoker', 'Pet' in relation to how they affect 'Absenteeism time in hours'. 
```{r social factors}
absenteeism_social <- absenteeism %>%
  select(ID, Education, Children, Social_drinker, Social_smoker, Pet, Absenteeism_time_in_hours)
absenteeism_social
```
Then we created a group called 'Biological', which includes details for 'human body', 'Age', 'Weight', 'Height', 'Body mass index' in relation to how they affect 'Absenteeism time in hours'.
```{r biological factors}
absenteeism_biological<- absenteeism %>%
  select(ID, Age, Weight, Height, Body_mass_index, Absenteeism_time_in_hours)
absenteeism_biological
```
Then our third group is called 'time', which have all the variables that are time related. 'Month of absence', 'Day of the week', 'Seasons', 'Service time', in relation to 'Absenteeism time in hours'.
```{r time-based factors}
absenteeism_time <- absenteeism %>%
  select(ID, Month_of_absence, Day_of_the_week, Seasons, Service_time, Absenteeism_time_in_hours)
absenteeism_time
```
In the end we have a group called 'Geog', which is related to geographical variables, 'Transportation expense', 'Distance from Residence to Work' in relation to 'Absenteeism time in hours'.
```{r geographical factors}
absenteeism_geog <- absenteeism %>%
  select(ID, Transportation_expense, Distance_from_Residence_to_Work, Absenteeism_time_in_hours)
absenteeism_geog
```

# Hypothesis
Our group was firstly interested in 'Social', we are specifically interested in 'education level' and 'absenteeism hours'. Our hypothesis is such that the higher your education level, the less you will be absent as we think that people are likely to be more punctual as they receive more education.

# Method
To test our hypothesis, we made a box plot, so that we can see the difference between the four different education levels. We used a box plot because we are able to see median, maximum and minimum of the hours of absenteeism of people. We did faceting in order to put these four levels together to make our table tidy. In the end we restricted the limit, because there are to many outliers for people with education level one.

```{r warning = FALSE, out.width = "70%", out.height = "70%", echo = FALSE, fig.align = "centre"}
ggplot(data = absenteeism, aes(x = Education, y = Absenteeism_time_in_hours)) +
  geom_boxplot() + 
  facet_wrap(~ Education) +
  ylim(0, 75) +
  labs(title = "Absenteeism time based on education level", 
       x = "Education level",
       y = "absenteeism time (hours)") +
  coord_flip() 

educ <- select(absenteeism, Education)
educ_4 <- filter(educ, Education == 4)
nrow(educ_4)
educ_3 <- filter(educ, Education == 3)
nrow(educ_3)
educ_2 <- filter(educ, Education == 2)
nrow(educ_2)
educ_1 <- filter(educ, Education == 1)
nrow(educ_1)


```

# Observations
We looked at the data frame for education level. Surprisingly there are only four people with education level four. There are 608 people with education level 1, which is over 82 percent of the total number of people participated. Meanwhile Education level four has the smallest range. Education level two and three have similar amount of people, which are 79 and 46 respectively. 

# Analysis
There are absolutely 0 outliers for education level four, which we think is because the number of people with education level four is too small, and the reason for so many outliers for education level one is because there are too many people with that education level. We therefore believe it is better to eliminate people with education level four. The box plot showed on average that people with education level one are less likely to be absent, which is perhaps because they thrive to keep this job as they have fewer job opportunities than people who are more qualified.

# Hypothesis
After social, we looked at geographical factors. Our hypothesis is that further away you live from where you work, the more likely you are to be absent. We think this because if you live further away, you are more likely to encounter traffic which could accumulate more hours of absenteeism. Living far away from work could also lead to having to take public transport, which can be unreliable, as well as transportation expense, which could also affect absenteeism.

# Method
```{r grouping the geographical}
absenteeism_geog <- absenteeism_geog %>%
  group_by(ID) %>%
  summarise(
    Transportation_expense = mean(Transportation_expense),
    Distance_from_Residence_to_Work = mean(Distance_from_Residence_to_Work),
    Absenteeism_time_in_hours = sum(Absenteeism_time_in_hours))
absenteeism_geog
```
We did a linear regression first, because we have two numerical variables. We assume that absenteeism time in hours is somehow linked to transportation expense plus distance from residence to work.
```{r geographical linear regression}
geog_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(Absenteeism_time_in_hours ~ Transportation_expense + Distance_from_Residence_to_Work, data = absenteeism_geog) 
geog_fit

ggplot() +
  geom_point(data = absenteeism_geog, aes( x = Transportation_expense + Distance_from_Residence_to_Work, y = Absenteeism_time_in_hours ))


```
After our linear regression we believe it is good to do a residual plot in order to see how good the linear model fits the data we have.
```{r}
geog_fit_aug <- augment(geog_fit$fit)

ggplot(geog_fit_aug, mapping = aes(x = .fitted, y = .resid)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, color = "red",lty = "dashed") +
  labs(x = "Predicted hours off work", y = "Residuals")
```

# Observation
We observed that the further away from where you live, the less absenteeism hours you will have. However, the residual graph is not really random enough, so we assume it is better to do a log based one.

# Method 
This time we do log(absenteeism time in hours), and see what is the new observation.
```{r geographical linear regression plus logs}
absenteeism_geog <- mutate(absenteeism_geog, log_Absenteeism_time_in_hours = log(Absenteeism_time_in_hours))
absenteeism_geog
geog_fit_log <- linear_reg() %>%
  set_engine("lm") %>%
  fit(log_Absenteeism_time_in_hours ~ Transportation_expense + Distance_from_Residence_to_Work, data = absenteeism_geog) 
geog_fit_log

ggplot() +
  geom_point(data = absenteeism_geog, aes( x = Transportation_expense + Distance_from_Residence_to_Work, y = log_Absenteeism_time_in_hours))
```

```{r}
geog_fit_log_aug <- augment(geog_fit_log$fit)

ggplot(geog_fit_log_aug, mapping = aes(x = .fitted, y = .resid)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, color = "red", lty = "dashed") +
  labs(x = "Predicted hours off work", y = "Residuals")
```

#Social factors
```{r Grouping social factors}
absenteeism_social <- absenteeism_social %>%
  group_by(ID) %>%
  summarise(
    Education = mean(Education),
    Children = mean(Children),
    Social_drinker = mean(Social_drinker),
    Social_smoker = mean(Social_smoker),
    Pet = mean(Pet),
    Absenteeism_time_in_hours = sum(Absenteeism_time_in_hours))
absenteeism_social
```

```{r warning = FALSE, out.width = "70%", out.height = "70%", echo = FALSE, fig.align = "centre"}
ggplot(data = absenteeism_social, aes(x = Education, y = Absenteeism_time_in_hours)) +
  geom_boxplot() + 
  facet_wrap(~ Education) +
  ylim(0, 75) +
  labs(title = "Absenteeism time based on education level", 
       x = "Education level",
       y = "absenteeism time (hours)") +
  coord_flip()
```

```{r}
absenteeism_social %>%
  count(Education)

absenteeism_social <- absenteeism_social %>%
  select( -c(Education) ) 
```

```{r}
ggplot(data = absenteeism_social, aes(x = Pet + Social_drinker + Social_smoker, y = Absenteeism_time_in_hours )) +
  geom_point(postion = "jitter") +
  geom_smooth(method = "lm",se = FALSE) + 
  labs(
    title = "Predicted time off vs Amount of pets & Social drinking/smoking",
    subtitle = "Employees of a Brazilian courier company July 2007-10",
    x = "Amount of pets plus Social drinking/smoking)",
    y = "Predicted time off work (hours)"
  )

social_fit_pet <- linear_reg() %>%
  set_engine("lm") %>%
  fit(Absenteeism_time_in_hours ~ Pet + Social_drinker + Social_smoker, data = absenteeism_social) 
social_fit_pet

```

```{r}

ggplot(data = absenteeism_social, aes(x = Children + Social_drinker + Social_smoker, y = Absenteeism_time_in_hours )) +
  geom_point(position = "jitter") +
  geom_smooth(method = "lm", se = FALSE) + 
  labs(
    title = "Predicted time off vs Amount of children & Social drinking/smoking",
    subtitle = "Employees of a Brazilian courier company July 2007-10",
    x = "Amount of children plus Social drinking/smoking)",
    y = "Predicted time off work (hours)"
  )

social_fit_child <- linear_reg() %>%
  set_engine("lm") %>%
  fit(Absenteeism_time_in_hours ~ Children + Social_drinker + Social_smoker, data = absenteeism_social) 
social_fit_child

```

```{r}
ggplot(data = absenteeism_social, aes(x = Children + Pet + Social_drinker + Social_smoker, y = Absenteeism_time_in_hours )) +
  geom_point(position = "jitter") +
  geom_smooth(method = "lm", se = FALSE) + 
  labs(
    title = "Predicted time off vs Amount of children, Pets & Social drinking/smoking",
    subtitle = "Employees of a Brazilian courier company July 2007-10",
    x = "Amount of children plus Social drinking/smoking)",
    y = "Predicted time off work (hours)"
  )

social_fit_childpet <- linear_reg() %>%
  set_engine("lm") %>%
  fit(Absenteeism_time_in_hours ~ Children + Pet , data = absenteeism_social) %>%
  tidy()
glimpse(social_fit_child)$r.square

```

